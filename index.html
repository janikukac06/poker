<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Póker Tanuló</title>
    <style>
        /* Main layout */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #006633;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .table {
            width: 800px;
            height: 600px;
            background-color: #008844;
            border-radius: 200px;
            border: 15px solid #553311;
            position: relative;
            padding: 20px;
        }
        .robot, .player {
            position: absolute;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 10px;
            color: white;
        }
        .robot-1 {
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
        }
        .robot-2 {
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
        }
        .robot-3 {
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
        }
        .player {
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }
        .cards {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .card {
            width: 60px;
            height: 80px;
            background-color: white;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
            font-weight: bold;
            font-size: 30px;
        }
        .card-back {
            background-image: linear-gradient(45deg, #5a8cc5 25%, #36648b 25%, #36648b 50%, #5a8cc5 50%, #5a8cc5 75%, #36648b 75%, #36648b 100%);
            background-size: 20px 20px;
            color: transparent !important;
        }
        .player-info {
            margin-top: 5px;
        }
        .dealer-button {
            width: 30px;
            height: 30px;
            background-color: white;
            border-radius: 50%;
            color: black;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: absolute;
        }
        .player .dealer-button {
            bottom: 60px;
            right: -15px;
        }
        .robot .dealer-button {
            top: 60px;
            right: -15px;
        }
        .blind {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: absolute;
            font-size: 12px;
        }
        .small-blind {
            background-color: white;
            color: black;
        }
        .big-blind {
            background-color: red;
            color: white;
        }
        .player .blind {
            bottom: 60px;
            left: -15px;
        }
        .robot .blind {
            top: 60px;
            left: -15px;
        }
        .bet-amount {
            position: absolute;
            font-size: 16px;
            font-weight: bold;
            color: yellow;
        }
        .player .bet-amount {
            top: -30px;
        }
        .robot .bet-amount {
            bottom: -30px;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .active-player {
            border: 3px solid red;
            border-radius: 10px;
            padding: 5px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }
        .thinking {
            position: absolute;
            font-weight: bold;
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            display: none;
        }
        .robot .thinking {
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
        }
    </style>
    <script>
        // Card definitions
        const suits = ['♥', '♦', '♠', '♣'];
        const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        let deck = [];
        let playerHand = [];
        let robotHand = [];
        let communityCards = [];
        
        // Game state
        let isPlayerDealer = true; // Player starts as dealer
        let smallBlindAmount = 10;
        let bigBlindAmount = 20;
        let playerChips = 1000;
        let robotChips = 1000;
        let potAmount = 0;
        let playerBet = 0;
        let robotBet = 0;
        let currentBettingRound = 'none'; // none, preflop, flop, turn, river, showdown
        let isPlayerTurn = false; // Track whose turn it is
        
        // Create and shuffle the deck
        function initializeDeck() {
            deck = [];
            // Create the deck
            for (let suit of suits) {
                for (let value of values) {
                    deck.push({ suit, value });
                }
            }
            // Shuffle the deck
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        // Deal cards to players
        function dealCards() {
            // Reset hands and community cards
            playerHand = [];
            robotHand = [];
            communityCards = [];
            
            // Deal 2 cards to each player
            playerHand.push(deck.pop());
            robotHand.push(deck.pop());
            playerHand.push(deck.pop());
            robotHand.push(deck.pop());
            
            // Update the UI
            updatePlayerCards();
            updateRobotCards();
            updateCommunityCards();
        }

        // Deal the flop (first 3 community cards)
        function dealFlop() {
            // Burn a card (discard)
            deck.pop();
            
            // Deal 3 community cards
            for (let i = 0; i < 3; i++) {
                communityCards.push(deck.pop());
            }
            
            updateCommunityCards();
        }

        // Deal the turn (4th community card)
        function dealTurn() {
            // Burn a card
            deck.pop();
            
            // Deal the turn card
            communityCards.push(deck.pop());
            
            updateCommunityCards();
        }

        // Deal the river (5th community card)
        function dealRiver() {
            // Burn a card
            deck.pop();
            
            // Deal the river card
            communityCards.push(deck.pop());
            
            updateCommunityCards();
        }

        // Update player cards in the UI
        function updatePlayerCards() {
            const playerCardElements = document.querySelectorAll('.player .card');
            
            // Show player's cards
            for (let i = 0; i < playerHand.length; i++) {
                const card = playerHand[i];
                const color = (card.suit === '♥' || card.suit === '♦') ? 'red' : 'black';
                playerCardElements[i].innerHTML = `${card.value}${card.suit}`;
                playerCardElements[i].style.color = color;
            }
        }

        // Update robot cards in the UI
        function updateRobotCards() {
            const robotCardElements = document.querySelectorAll('.robot .card');
            
            // Keep the robot's cards hidden with a card back design
            for (let i = 0; i < robotCardElements.length; i++) {
                robotCardElements[i].innerHTML = '?'; // Still need this for structure but it won't be visible
                robotCardElements[i].classList.add('card-back');
            }
        }

        // Update community cards in the UI
        function updateCommunityCards() {
            const communityCardElements = document.querySelectorAll('.pot .card');
            
            // Show revealed community cards, keep others hidden
            for (let i = 0; i < communityCardElements.length; i++) {
                if (i < communityCards.length) {
                    const card = communityCards[i];
                    const color = (card.suit === '♥' || card.suit === '♦') ? 'red' : 'black';
                    communityCardElements[i].innerHTML = `${card.value}${card.suit}`;
                    communityCardElements[i].style.color = color;
                } else {
                    communityCardElements[i].innerHTML = '?';
                    communityCardElements[i].style.color = 'black';
                }
            }
        }

        // Start a new game
        function startNewGame() {
            // Reset game state
            playerChips = 1000;
            robotChips = 1000;
            potAmount = 0;
            playerBet = 0;
            robotBet = 0;
            
            // Toggle dealer position for the next game
            isPlayerDealer = !isPlayerDealer;
            
            // Initialize the deck and deal cards
            initializeDeck();
            dealCards();
            
            // Place blinds
            placeBlinds();
            
            // Update UI
            updateChips();
            updateDealerButton();
            updateBlinds();
            
            // Start preflop betting round
            currentBettingRound = 'preflop';
            
            // Set active player turn
            // Player after big blind acts first
            if (isPlayerDealer) {
                // If player is dealer, robot acts first (as small blind)
                setActivePlayer(false);
                robotActionWithDelay(); // Robot makes first move
            } else {
                // If robot is dealer, player acts first (as small blind)
                setActivePlayer(true);
            }
            
            // Enable betting buttons
            updateActionButtons();
        }
        
        // Place blinds based on dealer position
        function placeBlinds() {
            if (isPlayerDealer) {
                // Player is dealer, robot posts small blind, player posts big blind
                robotBet = smallBlindAmount;
                robotChips -= smallBlindAmount;
                playerBet = bigBlindAmount;
                playerChips -= bigBlindAmount;
            } else {
                // Robot is dealer, player posts small blind, robot posts big blind
                playerBet = smallBlindAmount;
                playerChips -= smallBlindAmount;
                robotBet = bigBlindAmount;
                robotChips -= bigBlindAmount;
            }
            
            // Add blinds to the pot
            potAmount = playerBet + robotBet;
            
            updateChips();
        }
        
        // Update the chips display
        function updateChips() {
            document.querySelector('.robot p').textContent = `Robot: ${robotChips}`;
            document.querySelector('.player-info').textContent = `Falatka: ${playerChips}`;
            document.querySelector('.pot p').textContent = `Pot: ${potAmount}`;
            
            // Update bet amounts
            let playerBetElement = document.querySelector('.player .bet-amount');
            let robotBetElement = document.querySelector('.robot .bet-amount');
            
            if (playerBet > 0) {
                playerBetElement.textContent = playerBet;
                playerBetElement.style.display = 'block';
            } else {
                playerBetElement.style.display = 'none';
            }
            
            if (robotBet > 0) {
                robotBetElement.textContent = robotBet;
                robotBetElement.style.display = 'block';
            } else {
                robotBetElement.style.display = 'none';
            }
        }
        
        // Update dealer button position
        function updateDealerButton() {
            let playerDealerButton = document.querySelector('.player .dealer-button');
            let robotDealerButton = document.querySelector('.robot .dealer-button');
            
            if (isPlayerDealer) {
                playerDealerButton.style.display = 'flex';
                robotDealerButton.style.display = 'none';
            } else {
                playerDealerButton.style.display = 'none';
                robotDealerButton.style.display = 'flex';
            }
        }
        
        // Update blinds indicators
        function updateBlinds() {
            let playerBlind = document.querySelector('.player .blind');
            let robotBlind = document.querySelector('.robot .blind');
            
            if (isPlayerDealer) {
                // Player is dealer, robot has small blind, player has big blind
                playerBlind.textContent = 'BB';
                playerBlind.classList.remove('small-blind');
                playerBlind.classList.add('big-blind');
                
                robotBlind.textContent = 'SB';
                robotBlind.classList.add('small-blind');
                robotBlind.classList.remove('big-blind');
            } else {
                // Robot is dealer, player has small blind, robot has big blind
                playerBlind.textContent = 'SB';
                playerBlind.classList.add('small-blind');
                playerBlind.classList.remove('big-blind');
                
                robotBlind.textContent = 'BB';
                robotBlind.classList.remove('small-blind');
                robotBlind.classList.add('big-blind');
            }
            
            playerBlind.style.display = 'flex';
            robotBlind.style.display = 'flex';
        }
        
        // Set active player (visual indicator)
        function setActivePlayer(playerActive) {
            isPlayerTurn = playerActive;
            const playerElement = document.querySelector('.player');
            const robotElement = document.querySelector('.robot');
            const robotThinking = document.querySelector('.robot .thinking');
            
            if (playerActive) {
                playerElement.classList.add('active-player');
                robotElement.classList.remove('active-player');
                robotThinking.style.display = 'none';
                
                // Enable player action buttons
                document.querySelectorAll('.action-buttons button').forEach(button => {
                    button.disabled = false;
                });
            } else {
                playerElement.classList.remove('active-player');
                robotElement.classList.add('active-player');
                robotThinking.style.display = 'block';
                
                // Disable player action buttons while robot is thinking
                document.querySelectorAll('.action-buttons button').forEach(button => {
                    button.disabled = true;
                });
            }
        }
        
        // Player actions
        function playerCheck() {
            // Player can only check if robot hasn't bet more
            if (robotBet <= playerBet) {
                setActivePlayer(false); // Set robot's turn
                robotActionWithDelay();
            }
        }
        
        function playerCall() {
            // Match the robot's bet
            const callAmount = robotBet - playerBet;
            playerChips -= callAmount;
            playerBet = robotBet;
            potAmount += callAmount;
            
            updateChips();
            
            // When player calls, betting round ends and we move to next stage (proper poker rules)
            advanceToNextRound();
        }
        
        function playerRaise() {
            // Raise by big blind amount
            const raiseAmount = bigBlindAmount;
            const totalBet = robotBet + raiseAmount - playerBet;
            
            playerChips -= totalBet;
            playerBet = robotBet + raiseAmount;
            potAmount += totalBet;
            
            updateChips();
            setActivePlayer(false); // Set robot's turn
            robotActionWithDelay();
        }
        
        function playerFold() {
            // Robot wins the pot
            robotChips += potAmount;
            potAmount = 0;
            playerBet = 0;
            robotBet = 0;
            
            updateChips();
            // Start a new game after a delay
            setTimeout(startNewGame, 1500);
        }
        
        // Apply a random delay to robot's action
        function robotActionWithDelay() {
            // Random delay between 3 and 8 seconds
            const delayTime = Math.floor(Math.random() * 5000) + 3000;
            
            setTimeout(() => {
                robotAction();
            }, delayTime);
        }
        
        // Simple robot AI
        function robotAction() {
            // Simple random decision making
            const action = Math.random();
            
            if (action < 0.1) {
                // Fold
                playerChips += potAmount;
                potAmount = 0;
                playerBet = 0;
                robotBet = 0;
                updateChips();
                alert("Robot folds!");
                setTimeout(startNewGame, 1500);
            } else if (action < 0.4 && playerBet > robotBet) {
                // Call
                const callAmount = playerBet - robotBet;
                robotChips -= callAmount;
                robotBet = playerBet;
                potAmount += callAmount;
                updateChips();
                advanceToNextRound();
            } else if (action < 0.7 && playerBet <= robotBet) {
                // Check
                advanceToNextRound();
            } else {
                // Raise
                const raiseAmount = bigBlindAmount;
                const totalBet = playerBet + raiseAmount - robotBet;
                
                robotChips -= totalBet;
                robotBet = playerBet + raiseAmount;
                potAmount += totalBet;
                
                updateChips();
                // Enable player action buttons for response
                setActivePlayer(true); // Set player's turn
                updateActionButtons();
            }
        }
        
        // Advance to the next betting round
        function advanceToNextRound() {
            // Move bets to pot and reset current bets
            playerBet = 0;
            robotBet = 0;
            
            switch (currentBettingRound) {
                case 'preflop':
                    currentBettingRound = 'flop';
                    dealFlop();
                    break;
                case 'flop':
                    currentBettingRound = 'turn';
                    dealTurn();
                    break;
                case 'turn':
                    currentBettingRound = 'river';
                    dealRiver();
                    break;
                case 'river':
                    currentBettingRound = 'showdown';
                    showdown();
                    break;
            }
            
            updateChips();
            
            // Set active player (dealer acts first after the flop)
            if (currentBettingRound !== 'showdown') {
                setActivePlayer(isPlayerDealer);
            }
            
            updateActionButtons();
        }
        
        // Update action buttons based on game state
        function updateActionButtons() {
            const actionButtons = document.querySelector('.action-buttons');
            
            if (currentBettingRound === 'none' || currentBettingRound === 'showdown') {
                actionButtons.style.display = 'none';
            } else {
                actionButtons.style.display = 'flex';
                
                // Enable/disable buttons based on context
                const checkButton = document.getElementById('check-button');
                const callButton = document.getElementById('call-button');
                
                if (robotBet > playerBet) {
                    // Can't check if robot has bet more
                    checkButton.disabled = true;
                    callButton.disabled = false;
                } else {
                    checkButton.disabled = false;
                    callButton.disabled = true;
                }
                
                // If it's not player's turn, disable all buttons
                if (!isPlayerTurn) {
                    document.querySelectorAll('.action-buttons button').forEach(button => {
                        button.disabled = true;
                    });
                }
            }
        }

        // Reveal the robot's cards (for learning purposes)
        function revealRobotCards() {
            const robotCardElements = document.querySelectorAll('.robot .card');
            
            for (let i = 0; i < robotHand.length; i++) {
                const card = robotHand[i];
                const color = (card.suit === '♥' || card.suit === '♦') ? 'red' : 'black';
                robotCardElements[i].innerHTML = `${card.value}${card.suit}`;
                robotCardElements[i].style.color = color;
                robotCardElements[i].classList.remove('card-back');
            }
        }

        // Showdown - determine winner
        function showdown() {
            // For now, just reveal cards and give pot to a random winner
            revealRobotCards();
            
            setTimeout(() => {
                const randomWinner = Math.random() > 0.5;
                if (randomWinner) {
                    alert("Falatka wins the pot!");
                    playerChips += potAmount;
                } else {
                    alert("Robot wins the pot!");
                    robotChips += potAmount;
                }
                potAmount = 0;
                updateChips();
                
                // Start a new game
                setTimeout(startNewGame, 1500);
            }, 2000);
        }

        // Initialize the game when the page loads
        window.onload = function() {
            startNewGame();
        };
    </script>
</head>
<body>
    <div class="table">
        <div class="robot robot-1">
            <p>Robot: 1000</p>
            <div class="cards">
                <div class="card">?</div>
                <div class="card">?</div>
            </div>
            <div class="dealer-button" style="display: none;">D</div>
            <div class="blind" style="display: none;">SB</div>
            <div class="bet-amount" style="display: none;">0</div>
            <div class="thinking">Thinking...</div>
        </div>
        <div class="robot robot-2">
            <p>Robot: 1000</p>
            <div class="cards">
                <div class="card">?</div>
                <div class="card">?</div>
            </div>
            <div class="dealer-button" style="display: none;">D</div>
            <div class="blind" style="display: none;">SB</div>
            <div class="bet-amount" style="display: none;">0</div>
            <div class="thinking">Thinking...</div>
        </div>
        <div class="robot robot-3">
            <p>Robot: 1000</p>
            <div class="cards">
                <div class="card">?</div>
                <div class="card">?</div>
            </div>
            <div class="dealer-button" style="display: none;">D</div>
            <div class="blind" style="display: none;">SB</div>
            <div class="bet-amount" style="display: none;">0</div>
            <div class="thinking">Thinking...</div>
        </div>
        <div class="pot">
            <p>Pot: 0</p>
            <div class="cards">
                <div class="card">?</div>
                <div class="card">?</div>
                <div class="card">?</div>
                <div class="card">?</div>
                <div class="card">?</div>
            </div>
        </div>
        <div class="player">
            <div class="cards">
                <div class="card">?</div>
                <div class="card">?</div>
            </div>
            <p class="player-info">Falatka: 1000</p>
            <div class="dealer-button" style="display: none;">D</div>
            <div class="blind" style="display: none;">SB</div>
            <div class="bet-amount" style="display: none;">0</div>
        </div>
    </div>
    
    <div class="action-buttons" style="display: none; margin-top: 10px;">
        <button id="check-button" onclick="playerCheck()">Check</button>
        <button id="call-button" onclick="playerCall()">Call</button>
        <button id="raise-button" onclick="playerRaise()">Raise</button>
        <button id="fold-button" onclick="playerFold()">Fold</button>
    </div>
    
    <div class="controls" style="margin-top: 20px; text-align: center;">
        <button onclick="startNewGame()">New Game</button>
        <button onclick="revealRobotCards()">Reveal Robot's Cards</button>
    </div>
</body>
</html>
